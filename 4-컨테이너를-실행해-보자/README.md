# 컨테이너를 실행해 보자

## 도커 엔진 시작하기/종료하기

### 도커 엔진을 시작/종료하는 방법

- 도커 엔진은 계속 동작 상태로 남아 있는다.

- 컨테이너를 실행 중이 아니라면 컴퓨터의 리소스를 거의 차지하지 않는다.

- 컨테이너에는 자동 실행 설정이 없어서, 별도로 스크립트를 작성해야 한다.

- 리눅스 명령어
    ```python
    # 도커 엔진 시작
    sudo systemctl start docker

    # 도커 엔진 종료
    sudo systemctl stop docker

    # 자동 실행 설정
    sudo systemctl enable docker
    ```

<br />

## 컨테이너의 기본적인 사용 방법

### 컨테이너 사용의 기본은 도커 명령어

- docker 명렁어의 기본적인 형태
    ```bash
    # docker 커맨드 (옵션) 대상 (인자)
    docker container run -d penguin --mode=1
    ```

- 옵션은 - 또는 --으로 시작한다.

- -를 하나만 사용하는 옵션은 한꺼번에 모아 쓸 수 있다.
    - e.g., -dit

### 대표적인 명령어

- 컨테이너 조작 관련 커맨드

    | 하위 커맨드 | 내용 | 주요 옵션 |
    |---|---|---|
    | start | 컨테이너를 실행 | -i |
    | stop | 컨테이너를 정지 |  |
    | create | 도커 이미지로부터 컨테이너를 생성 | --name -e -p -v |
    | run | 도커 이미지를 내려받고, 컨테이너를 생성해 실행함. docker image pull, docker container create, docker container start라는 세개의 명령을 하나로 합친 것과 같다. | --name -e -p -v -d -i -t |
    | rm | 정지 상태의 컨테이너를 삭제 | -f -v |
    | exec | 실행 중인 컨테이너 속에서 프로그램을 실행 | -i -t |
    | ls | 컨테이너 목록을 출력 | -a |
    | cp | 도커 컨테이너와 도커 호스트 간에 파일을 복사 |  |
    | commit | 도커 컨테이너 이미지로 변환 |  |

- 이미지 조작 관련 커맨드

    | 하위 커맨드 | 내용 | 주요 옵션 |
    |---|---|---|
    | pull | 도커 허브 등의 리포지토리에서 이미지를 내려받음 |  |
    | rm | 도커 이미지를 삭제 |  |
    | ls | 내려 받은 이미지의 목록을 출력 |  |
    | build | 도커 이미지를 생성 | -t |

- 볼륨 조작 관련 커맨드

    | 하위 커맨드 | 내용 | 주요 옵션 |
    |---|---|---|
    | create | 볼륨을 생성 | —name |
    | inspect | 볼륨의 상세 정보를 출력 |  |
    | ls | 볼륨의 목록을 출력 | -a |
    | prune | 현재 마운트되지 않은 볼륨을 모두 삭제 |  |
    | rm | 지정한 볼륨을 삭제 |  |

- 네트워크 조작 관련 커맨드

    | 하위 커맨드 | 내용 | 주요 옵션 |
    |---|---|---|
    | connect | 컨테이너를 도커 네트워크에 연결 |  |
    | disconnect | 컨테이너의 도커 네트워크 연결을 해제 |  |
    | create | 도커 네트워크를 생성 |  |
    | inspect | 도커 네트워크의 상세 정보를 출력 |  |
    | ls | 도커 네트워크의 목록을 출력 |  |
    | prune | 현재 컨테이너가 접속하지 않은 네트워크를 모두 삭제 |  |
    | rm | 지정한 네트워크를 삭제 |  |

- 단독으로 쓰이는 커맨드

    | 하위 커맨드 | 내용 | 주요 옵션 |
    |---|---|---|
    | login | 도커 레지스트리에 로그인 | -u -p |
    | logout | 도커 레지스트리에 로그아웃 |  |
    | search | 도커 레지스트리를 검색 |  |
    | version | 도커 엔진 및 명령행 도구의 버전을 출력 |  |

<br />

## 컨테이너의 생성과 삭제, 실행, 정지

### docker container run, stop, rm 커맨드

- docker run은 이미지를 받고, 컨테이너를 생성하고, 시작하는 기능을 한다.

- 동작 중인 컨테이너를 그대로 삭제할 수는 없다.

- run 커맨드와 함께 사용하는 주요 옵션

    | 옵션 형식 | 내용 |
    |---|---|
    | --name 컨테이너_이름 | 컨테이너 이름을 지정함 |
    | -p 호스트_프트번호:컨테이너_포트번호 | 포트 번호를 지정함 |
    | -v 호스트_디스크:컨테이너_디렉터리 | 볼륨을 마운트함 |
    | --net=네트워크_이름 | 컨테이너를 네트워크에 연결함 |
    | -e 환경변수_이름=값 | 환경변수를 설정함 |
    | -d | 백그라운드로 실행함 |
    | -i | 컨테이너에 터미널(키보드)을 연결함 |
    | -t | 특수 키를 사용 가능하도록 함 |
    | -help | 사용 방법 안내 메세지를 출력함 |

### docker ps 커맨드

- docker ps (docker container ls) 커맨드는 컨테이너의 목록을 출력하는 기능을 한다.

- 컨테이너 목록의 주요 항목

    | 항목 | 내용 |
    |---|---|
    | CONTAINER ID | 컨테이너 식별자. 무작위 문자열이 할당된다. 본래는 64글자이지만 앞에서부터 12글자만 출력한다. |
    | IMAGE | 컨테이너를 만들 때 사용한 이미지의 이름 |
    | COMMAND | 컨테이너 실행 시에 실행하도록 설정된 프로그램의 이름. 크게 신경쓰지 않아도 된다. |
    | CREATED | 컨테이너 생성 후 경과된 시간 |
    | STATUS | 컨테이너의 현재 상태. 실행 중이라면 ‘UP’, 종료된 상태라면 ‘Exited’가 출력된다. |
    | PORTS | 컨테이너에 할당된 포트 번호, ‘호스트 포트 번호 → 컨테이너 포트 번호’ 형식으로 출력된다. 포트 번호가 동일할 경우 →의 뒷부분은 출력되지 않는다. |
    | NAMES | 컨테이너 이름 |

### 컨테이너의 통신

- 웹 브라우저를 통해 컨테이너에 접근하려면 외부와 접속하기 위한 설정이 필요하다.
    - 통신 내용이 드나드는 통로인 포트를 설정한다.

- 컨테이너를 실행 중인 물리적 컴퓨터가 외부의 접근을 대신 받아 전달해준다.

    ```bash
        # -p 호스트 포트 번호:컨테이너 포트 번호
        -p 8080:80
    ```

- 여러 개의 웹 서버를 함께 실행할 때, 호스트 포트 번호를 다르게 지정해야 한다.
    - 호스트 포트 번호를 모두 같은 것으로 사용하면 어떤 컨테이너로 가야 할 요청인지 구분할 수 없다.
    - 꼭 여러 컨테이너로 연결되는 포트를 같게 설정하고 싶다면 리버스 프락시로 서로 이름을 통해 구별하도록 구성한다.

<br />

## 이미지 삭제

### 이미지 삭제

- 컨테이너를 삭제해도 이미지는 그대로 남아있다.

- 필요없어진 이미지는 그떄그때 삭제하도록 한다.

- 해당 이미지로 실행한 컨테이너가 남아 있으면 이미지를 삭제할 수 없다.

```bash
docker image rm $image1 $image2 $image3
```